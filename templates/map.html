{% extends "base.html" %} {% block title %}Property Map{% endblock %} {% block
content %}
<h2>Interactive Property Map</h2>
<p>
  {% if properties_for_map %} Showing
  <strong>{{ properties_for_map | length }}</strong> properties on the map.
  Click on a marker for details. {% else %} No properties to display. Try
  performing a search on the 'Compare' page first. {% endif %}
</p>

<div
  id="map"
  style="
    height: 600px;
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  "
></div>
{% endblock %} {% block scripts %}
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>
<!-- ▼▼▼  MarkerCluster CSS ▼▼▼ -->
<!-- ====================================================================== -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
/>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<!-- Step 1: The "Data Bridge" -->
<!-- This script block runs first. It creates a global JavaScript variable 
     named 'propertyData' and fills it with the data from our Flask backend. -->
<script>
  const propertyData = {{ properties_for_map | tojson | safe }};
</script>

<!-- Step 2: Load our external map logic -->
<!-- This script runs second. It will find and use the 'propertyData' variable
     that we just created above. We add a version number to prevent caching issues. -->
<script src="{{ url_for('static', filename='map.js') }}?v=1.0"></script>

{% endblock %}
